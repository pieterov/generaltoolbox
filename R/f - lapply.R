##############################################################################################
# NAME:         FUNCTION - LAPPLY
# AUTHOR:       Pieter Overdevest
##############################################################################################

        f_lapply <- function(

                l.input,

                f.input,

                mc.cores = NULL
        ) {


        ######################################################################################
        # TEST
        ######################################################################################

        # f_test <- function(df.temp) {
        #
        #         df.temp %>%
        #
        #                 slice(-1, -n()) %>%
        #
        #                 rbind(df.temp)
        # }

        # l.input <- df.test
        # f.input <- f_test
        # mc.cores <- 4

        ######################################################################################
        # ERROR CHECKS
        ######################################################################################

        if(!"list" %in% class(l.input)) {

                stop("Note, input to f_lapply - l.input - must be a list!")
        }


        if(class(f.input) != "function") {

                stop("Note, input to f_lapply - f.input - must be a function!")
        }


        if(!is.null(mc.cores)) {

                if(mc.cores > detectCores()) {

                        stop(paste0(

                                "Note, mc.cores (", mc.cores,

                                ") exceeds the number of cores in your system (",

                                detectCores(), ")!"
                        ))
                }
        }


        ######################################################################################
        # INITIALIZATION
        ######################################################################################

        ######################################################################################
        # PROCESS
        ######################################################################################

        if (
                (
                        is.null(mc.cores) &

                        f_who_am_i() %in% c("Pieters-MacBook-Pro.local", "Pieters-MBP.home")
                ) |

                mc.cores > 1
        ) {

                l.output <- mclapply(l.input, f.input, mc.cores = mc.cores)

        } else {

                l.output <- lapply(l.input, f.input)
        }


        ######################################################################################
        # ERROR CHECK
        ######################################################################################


        ######################################################################################
        # RETURN
        ######################################################################################

        return(l.output)

        }

